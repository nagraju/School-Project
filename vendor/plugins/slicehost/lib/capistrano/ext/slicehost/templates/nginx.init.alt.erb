#! /bin/sh

# http://saturnboy.com/tag/nginx/

PATH=/opt/nginx/sbin:/sbin:/bin:/usr/sbin:/usr/bin
NAME=nginx
DAEMON=/opt/nginx/sbin/nginx
PID_FILE=/opt/nginx/logs/nginx.pid

test -x $DAEMON || exit 0

# Include nginx defaults if available
if [ -f /etc/default/nginx ] ; then
  . /etc/default/nginx
fi

set -e

function nginx_start() {
  if [ -e $DAEMON ]; then
    echo "Starting $NAME..."
    sudo $DAEMON
  else
    echo "$NAME pid file ($PID_FILE) not found"
    return 0
  fi
}

function nginx_stop() {
  if [ -e $PID_FILE ]; then
    echo "Stopping $NAME..."
    PID=`cat $PID_FILE`
    sudo kill -INT $PID
  else
    echo "$NAME pid file ($PID_FILE) not found"
    return 0
  fi
}
 
function nginx_restart() {
  if [ -e $PID_FILE ]; then
    nginx_stop();
    sleep 1
    nginx_start();
  else
    echo "$NAME pid file ($PID_FILE) not found"
    return 0
  fi
}

function nginx_reload() {
  if [ -e $PID_FILE ]; then
    echo "Not supported"
  else
    echo "$NAME pid file ($PID_FILE) not found"
    return 0
  fi
}

case "$1" in
  start)
        nginx_start();
        ;;
  stop)
        nginx_stop();
        ;;
  restart|force-reload|reload)
        nginx_restart();
        ;;
      *)
        N=/etc/init.d/$NAME
        echo "Usage: $N {start|stop|restart|reload|force-reload}" >&2
        exit 1   
        ;;
    esac
    
    exit 0
    